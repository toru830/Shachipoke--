# Phase 3: ゲーム機能拡張 計画書

## 🎯 Phase 3の目標

Phase 2で完成したデータベースを活用し、ゲーム機能を本格的に実装します。

## 📋 現在の実装状況

### ✅ 実装済み
- 基本UI: キャラクター選択、ホーム画面、設定画面
- イベントシステム: 3種類のイベント選択UI（実際の処理は未実装）
- ショップシステム: UIのみ（実際の処理は未実装）
- フォーメーションシステム: UIのみ（実際の処理は未実装）
- データ永続化: Supabase連携（基本実装済み）

### ❌ 未実装
- イベント結果処理
- ショップ購入処理
- フォーメーション変更処理
- データベースとの連携（イベント履歴、購入履歴の保存）
- キャラクター詳細情報の表示
- レベリングシステム
- デイリーリセット機能

## 🚀 Phase 3のタスク

### Phase 3-1: イベントシステムの完成（最優先）
**目標**: イベントを選択したら、結果が適用され、データベースに保存される

**実装内容**:
1. イベント選択処理の完成
2. イベント結果の適用（ステータス変化、報酬獲得）
3. イベント履歴のデータベース保存
4. デイリーリセット機能（今日のイベントを3回まで）
5. イベント完了後のフィードバック表示

**データベース連携**:
- `event_history`テーブルに記録
- `user_game_stats`テーブルの更新
- `game_saves`テーブルの更新

### Phase 3-2: ショップシステムの完成
**目標**: アイテムを購入したら、効果が適用され、データベースに保存される

**実装内容**:
1. アイテム購入処理の完成
2. アイテム効果の適用（ステータス変化、シャチ消費）
3. 購入履歴のデータベース保存
4. 在庫管理（同一アイテムの複数購入）
5. 購入時のフィードバック表示

**データベース連携**:
- `purchase_history`テーブルに記録
- `user_game_stats`テーブルの更新
- `game_saves`テーブルの更新

### Phase 3-3: フォーメーションシステムの完成
**目標**: パーティーを編成したら、データベースに保存される

**実装内容**:
1. パーティー編成処理の完成
2. パーティースロットへのキャラクター配置
3. パーティー情報のデータベース保存
4. パーティー変更UIの改善
5. アクティブパーティーの設定

**データベース連携**:
- `user_parties`テーブルに記録
- `user_characters`テーブルの更新（last_used_at）
- `game_saves`テーブルの更新

### Phase 3-4: キャラクター詳細表示
**目標**: キャラクターの詳細情報を表示するUIを追加

**実装内容**:
1. キャラクター詳細画面の追加
2. ステータス詳細表示
3. 習得スキル表示（将来的な機能）
4. アチーブメント表示（将来的な機能）

### Phase 3-5: レベルアップシステムの実装
**目標**: ステータスに応じてレベルが自動計算・更新される

**実装内容**:
1. レベルの自動計算（全ステータス合計 ÷ 40 + 1）
2. レベルアップ時の演出
3. レベルに応じた報酬システム（将来的な機能）
4. レベル表示の更新

**データベース連携**:
- `user_characters`テーブルのlevel更新
- `user_game_stats`テーブルのhighest_level_reached更新

### Phase 3-6: アチーブメントシステムの実装（オプション）
**目標**: プレイヤーの功績を記録する

**実装内容**:
1. アチーブメント定義の作成
2. アチーブメント達成チェック
3. アチーブメント一覧表示
4. 達成時の通知

**データベース連携**:
- `user_achievements`テーブルの更新
- 達成条件の自動チェック

## 🎯 Phase 3の優先順位

1. **Phase 3-1: イベントシステム**（最優先 - ゲームの核心）
2. **Phase 3-2: ショップシステム**（高優先度 - ゲームの魅力）
3. **Phase 3-3: フォーメーションシステム**（高優先度 - ゲームの深み）
4. **Phase 3-4: キャラクター詳細**（中優先度 - UI改善）
5. **Phase 3-5: レベルアップシステム**（中優先度 - システム完成）
6. **Phase 3-6: アチーブメント**（低優先度 - 将来的な機能）

## 📊 実装方針

### データベース活用
- Phase 2で作成したすべてのテーブルを活用
- SupabaseのRLSポリシーでセキュリティを確保
- リアルタイム同期（必要に応じて）

### UI/UX改善
- スムーズなアニメーション
- 適切なフィードバック
- エラーハンドリング
- ローディング表示

### パフォーマンス最適化
- 必要最小限のデータ取得
- バッチ処理によるデータ保存
- キャッシュ活用

## 🚀 Phase 3-1から開始！

まずは「イベントシステムの完成」から着手します。これがゲームの核心機能です。

**Phase 3-1を開始しますか？**
